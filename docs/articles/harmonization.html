<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Survey Data Harmonization • eurobarometer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Survey Data Harmonization">
<meta property="og:description" content="eurobarometer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eurobarometer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/harmonization.html">Survey Data Harmonization</a>
    </li>
    <li>
      <a href="../articles/metadata.html">Working With Metadata</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/antaldaniel/eurobarometer/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="harmonization_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Survey Data Harmonization</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antaldaniel/eurobarometer/blob/master/vignettes/harmonization.Rmd"><code>vignettes/harmonization.Rmd</code></a></small>
      <div class="hidden name"><code>harmonization.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">eurobarometer</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)</pre></body></html></div>
<p>The <a href="http://eurobarometer.danielantal.eu/">eurobarometer</a> package relies on the survey class system of <a href="http://retroharmonize.satellitereport.com/">retroharmonize</a>. You do not have to load the entire <code>retroharmonize</code> package - whatever is needed to make <code>eurobarometer</code> work is imported and modified as needed.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ZA6863</span> <span class="kw">&lt;-</span> <span class="fu">read_rds</span>(
  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"examples"</span>, <span class="st">"ZA6863.rds"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"eurobarometer"</span>)
)
<span class="no">ZA7576</span> <span class="kw">&lt;-</span> <span class="fu">read_rds</span>(
  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"examples"</span>, <span class="st">"ZA7576.rds"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"eurobarometer"</span>)
)</pre></body></html></div>
<div id="metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#metadata" class="anchor"></a>Metadata</h2>
<p>The metadata analysis is a first step to help both variable name and value label harmonization.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ZA6863_metadata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gesis_metadata_create.html">gesis_metadata_create</a></span>(<span class="no">ZA6863</span>)
<span class="no">ZA7576_metadata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gesis_metadata_create.html">gesis_metadata_create</a></span>(<span class="no">ZA7576</span>)</pre></body></html></div>
<p>Variables of base types <code>numeric</code> and <code>character</code> can be safely concatenated. The labelled, mainly categorical variables require special attention: their valid range and missing range must be harmonized before binding the two tables together.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ZA6863_items</span> <span class="kw">&lt;-</span> <span class="no">ZA6863_metadata</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span> (
    <span class="no">class_orig</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"character"</span>, <span class="st">"numeric"</span>) <span class="kw">|</span>
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span>(<span class="no">var_name_suggested</span>, <span class="fl">1</span>,<span class="fl">5</span>) <span class="kw">==</span> <span class="st">'trust'</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> (<span class="no">var_name_suggested</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span> ( <span class="no">var_name_suggested</span> <span class="kw">!=</span> <span class="st">'not_given'</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>()</pre></body></html></div>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">ZA7576_items</span> <span class="kw">&lt;-</span> <span class="no">ZA7576_metadata</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span> (
    <span class="no">class_orig</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"character"</span>, <span class="st">"numeric"</span>) <span class="kw">|</span>
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span>(<span class="no">var_name_suggested</span>, <span class="fl">1</span>,<span class="fl">5</span>) <span class="kw">==</span> <span class="st">'trust'</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> (<span class="no">var_name_suggested</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span> ( <span class="no">var_name_suggested</span> <span class="kw">!=</span> <span class="st">'not_given'</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>()</pre></body></html></div>
<p>In this case, the <code>var_label_suggest()</code> function worked perfectly, so we can approve the suggestions of <code><a href="../reference/gesis_metadata_create.html">gesis_metadata_create()</a></code>.</p>
<p>Let’s select the variables with identical names from the two surveys:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">hZA6863</span> <span class="kw">&lt;-</span> <span class="no">ZA6863</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span> ( <span class="kw">nm</span> <span class="kw">=</span> <span class="no">ZA6863_metadata</span>$<span class="no">var_name_suggested</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">all_of</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">intersect</a></span>(<span class="no">ZA6863_items</span>, <span class="no">ZA7576_items</span>)))</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">hZA7576</span> <span class="kw">&lt;-</span> <span class="no">ZA7576</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span> ( <span class="kw">nm</span> <span class="kw">=</span> <span class="no">ZA7576_metadata</span>$<span class="no">var_name_suggested</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">all_of</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">intersect</a></span>(<span class="no">ZA6863_items</span>, <span class="no">ZA7576_items</span>)))</pre></body></html></div>
<p>And have a look at their value labelling: [no idea why are this not identical.]</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">ZA6863_trust</span> <span class="kw">&lt;-</span> <span class="no">ZA6863_metadata</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span> ( <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span>(<span class="no">var_name_suggested</span>, <span class="fl">1</span>,<span class="fl">5</span>) <span class="kw">==</span> <span class="st">'trust'</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> ( <span class="no">labels</span>, <span class="no">na_levels</span> ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>( <span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">labels</span>, <span class="no">na_levels</span>) ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct_all.html">distinct_all</a></span>()

<span class="no">ZA6863_trust</span>$<span class="no">labels</span>[<span class="fl">1</span>]
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;              Tend to trust          Tend not to trust </span>
<span class="co">#&gt;                          1                          2 </span>
<span class="co">#&gt;                         DK Inap. (CY-TCC in isocntry) </span>
<span class="co">#&gt;                          3                          9</span>
<span class="no">ZA6863_trust</span>$<span class="no">labels</span>[<span class="fl">2</span>]
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;                  Tend to trust              Tend not to trust </span>
<span class="co">#&gt;                              1                              2 </span>
<span class="co">#&gt;                             DK Inap. (not CY-TCC in isocntry) </span>
<span class="co">#&gt;                              3                              9</span></pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">ZA7576_trust</span> <span class="kw">&lt;-</span> <span class="no">ZA7576_metadata</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span> ( <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span>(<span class="no">var_name_suggested</span>, <span class="fl">1</span>,<span class="fl">5</span>) <span class="kw">==</span> <span class="st">'trust'</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> ( <span class="no">labels</span>, <span class="no">na_levels</span> ) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>( <span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">labels</span>, <span class="no">na_levels</span>) ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct_all.html">distinct_all</a></span>()

<span class="no">ZA7576_trust</span>$<span class="no">labels</span>[<span class="fl">1</span>]
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;              Tend to trust          Tend not to trust </span>
<span class="co">#&gt;                          1                          2 </span>
<span class="co">#&gt;                         DK Inap. (CY-TCC in isocntry) </span>
<span class="co">#&gt;                          3                          9</span>
<span class="no">ZA7576_trust</span>$<span class="no">labels</span>[<span class="fl">2</span>]
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;                  Tend to trust              Tend not to trust </span>
<span class="co">#&gt;                              1                              2 </span>
<span class="co">#&gt;                             DK Inap. (not CY-TCC in isocntry) </span>
<span class="co">#&gt;                              3                              9</span></pre></body></html></div>
</div>
<div id="harmonize-the-value-labels" class="section level2">
<h2 class="hasAnchor">
<a href="#harmonize-the-value-labels" class="anchor"></a>Harmonize the value labels</h2>
<p>The <code><a href="https://rdrr.io/pkg/retroharmonize/man/harmonize_values.html">retroharmonize::harmonize_values()</a></code> is a prototype of the harmonization function. It should be adjusted to survey and question-block specific idiosyncrasies. This should be the work of various vocabulary tables, but the prototype can be made work with inputting the harmonization regex either as a list or as a data frame.</p>
<p>Because we would like to have the same harmonization for a question block, in this case we adopt the prototype with a regex. The <code><a href="https://rdrr.io/pkg/retroharmonize/man/harmonize_values.html">retroharmonize::harmonize_values()</a></code> function will normalize the labels, so you do not have to deal with capitalization and upper case versions. If you want to understand better the harmonization procedure, please refer to the <a href="http://retroharmonize.satellitereport.com/articles/harmonize_labels.html">Harmonize Value Labels</a> vignette of the <a href="http://retroharmonize.satellitereport.com/">retroharmonize</a> package.</p>
<blockquote>
<p>With a better imputing system, this could be automated to a high level, probably harmonizing all trend variables at the same time. The harmonize_eurobaromter should be something that deals with this.</p>
</blockquote>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">harmonize_trust</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
   <span class="kw pkg">retroharmonize</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/retroharmonize/man/harmonize_values.html">harmonize_values</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>,
  <span class="kw">harmonize_label</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">harmonize_labels</span> <span class="kw">=</span> (
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span> (
     <span class="kw">from</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"^tend\\sto|^trust"</span>, <span class="st">"^tend\\snot|not\\strust"</span>, <span class="st">"^dk|^don"</span>, <span class="st">"^inap"</span>),
    <span class="kw">to</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"trust"</span>, <span class="st">"not_trust"</span>, <span class="st">"do_not_know"</span>, <span class="st">"inap"</span>),
    <span class="kw">numeric_values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">99997</span>, <span class="fl">99999</span>))
    ),
  <span class="kw">na_values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">do_not_know</span> <span class="kw">=</span> <span class="fl">99997</span>, <span class="kw">declined</span> <span class="kw">=</span> <span class="fl">99998</span>, <span class="kw">inap</span> <span class="kw">=</span> <span class="fl">99999</span>),
  <span class="kw">na_range</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">id</span> <span class="kw">=</span> <span class="st">"survey_id"</span>,
  <span class="kw">name_orig</span> <span class="kw">=</span> <span class="kw">NULL</span>)
}</pre></body></html></div>
<p>Choosing the first <code>trust</code> vector, we can see that the harmonization records all metadata for reproducibility.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu">harmonize_trust</span> ( <span class="no">hZA6863</span>$<span class="no">trust_army</span>)
<span class="co">#&gt;  [1]     1     0 99997     0 99997     0     1     1     1     1 99997     1</span>
<span class="co">#&gt; [13]     1     0     0     0     0     1     0     1     1     1     0     1</span>
<span class="co">#&gt; [25]     1     0     1     1     1     1     0     1     0     0     1 99999</span>
<span class="co">#&gt; [37] 99999 99999 99999 99999     1     0     1     0     0     1 99997 99997</span>
<span class="co">#&gt; [49]     0     1</span>
<span class="co">#&gt; attr(,"labels")</span>
<span class="co">#&gt;   not_trust       trust do_not_know        inap </span>
<span class="co">#&gt;           0           1       99997       99999 </span>
<span class="co">#&gt; attr(,"label")</span>
<span class="co">#&gt; [1] "TRUST IN INSTITUTIONS: ARMY"</span>
<span class="co">#&gt; attr(,"na_values")</span>
<span class="co">#&gt; [1] 99997 99999</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "retroharmonize_labelled_spss_survey" "haven_labelled_spss"                </span>
<span class="co">#&gt; [3] "haven_labelled"                     </span>
<span class="co">#&gt; attr(,"id")</span>
<span class="co">#&gt; [1] "survey_id"</span>
<span class="co">#&gt; attr(,"survey_id_name")</span>
<span class="co">#&gt; [1] "x"</span>
<span class="co">#&gt; attr(,"survey_id_values")</span>
<span class="co">#&gt;     2     1     3     9 </span>
<span class="co">#&gt;     0     1 99997 99999 </span>
<span class="co">#&gt; attr(,"survey_id_label")</span>
<span class="co">#&gt; [1] "TRUST IN INSTITUTIONS: ARMY"</span>
<span class="co">#&gt; attr(,"survey_id_labels")</span>
<span class="co">#&gt;              Tend to trust          Tend not to trust </span>
<span class="co">#&gt;                          1                          2 </span>
<span class="co">#&gt;                         DK Inap. (CY-TCC in isocntry) </span>
<span class="co">#&gt;                          3                          9 </span>
<span class="co">#&gt; attr(,"survey_id_na_values")</span>
<span class="co">#&gt; [1] 9</span></pre></body></html></div>
<p>The coding appears very similar, so we use the same helper function for the same question in the other survey:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu">harmonize_trust</span> ( <span class="no">hZA7576</span>$<span class="no">trust_army</span>)
<span class="co">#&gt;  [1]     1     1     1     1     1     1     1     0     0     1     1 99997</span>
<span class="co">#&gt; [13]     0     1     1     1     0     0 99997     1 99997     1     0     0</span>
<span class="co">#&gt; [25]     0     1     0     1     0     0     1     0     0     0     1     0</span>
<span class="co">#&gt; [37]     0     1     0     1     0 99999 99999 99999 99999</span>
<span class="co">#&gt; attr(,"labels")</span>
<span class="co">#&gt;   not_trust       trust do_not_know        inap </span>
<span class="co">#&gt;           0           1       99997       99999 </span>
<span class="co">#&gt; attr(,"label")</span>
<span class="co">#&gt; [1] "TRUST IN INSTITUTIONS: ARMY"</span>
<span class="co">#&gt; attr(,"na_values")</span>
<span class="co">#&gt; [1] 99997 99999</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "retroharmonize_labelled_spss_survey" "haven_labelled_spss"                </span>
<span class="co">#&gt; [3] "haven_labelled"                     </span>
<span class="co">#&gt; attr(,"id")</span>
<span class="co">#&gt; [1] "survey_id"</span>
<span class="co">#&gt; attr(,"survey_id_name")</span>
<span class="co">#&gt; [1] "x"</span>
<span class="co">#&gt; attr(,"survey_id_values")</span>
<span class="co">#&gt;     2     1     3     9 </span>
<span class="co">#&gt;     0     1 99997 99999 </span>
<span class="co">#&gt; attr(,"survey_id_label")</span>
<span class="co">#&gt; [1] "TRUST IN INSTITUTIONS: ARMY"</span>
<span class="co">#&gt; attr(,"survey_id_labels")</span>
<span class="co">#&gt;              Tend to trust          Tend not to trust </span>
<span class="co">#&gt;                          1                          2 </span>
<span class="co">#&gt;                         DK Inap. (CY-TCC in isocntry) </span>
<span class="co">#&gt;                          3                          9 </span>
<span class="co">#&gt; attr(,"survey_id_na_values")</span>
<span class="co">#&gt; [1] 9</span></pre></body></html></div>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">trust_in_army</span> <span class="kw">&lt;-</span> <span class="kw pkg">retroharmonize</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/retroharmonize/man/concatenate.html">concatenate</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="fu">harmonize_trust</span> ( <span class="no">hZA6863</span>$<span class="no">trust_army</span>),
  <span class="kw">y</span> <span class="kw">=</span> <span class="fu">harmonize_trust</span> ( <span class="no">hZA7576</span>$<span class="no">trust_army</span>)
  )
<span class="no">trust_in_army</span>
<span class="co">#&gt;  [1]     1     0 99997     0 99997     0     1     1     1     1 99997     1</span>
<span class="co">#&gt; [13]     1     0     0     0     0     1     0     1     1     1     0     1</span>
<span class="co">#&gt; [25]     1     0     1     1     1     1     0     1     0     0     1 99999</span>
<span class="co">#&gt; [37] 99999 99999 99999 99999     1     0     1     0     0     1 99997 99997</span>
<span class="co">#&gt; [49]     0     1     1     1     1     1     1     1     1     0     0     1</span>
<span class="co">#&gt; [61]     1 99997     0     1     1     1     0     0 99997     1 99997     1</span>
<span class="co">#&gt; [73]     0     0     0     1     0     1     0     0     1     0     0     0</span>
<span class="co">#&gt; [85]     1     0     0     1     0     1     0 99999 99999 99999 99999</span>
<span class="co">#&gt; attr(,"id")</span>
<span class="co">#&gt; [1] "survey_id"</span>
<span class="co">#&gt; attr(,"labels")</span>
<span class="co">#&gt;   not_trust       trust do_not_know        inap </span>
<span class="co">#&gt;           0           1       99997       99999 </span>
<span class="co">#&gt; attr(,"label")</span>
<span class="co">#&gt; [1] "TRUST IN INSTITUTIONS: ARMY"</span>
<span class="co">#&gt; attr(,"na_values")</span>
<span class="co">#&gt; [1] 99997 99999</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "retroharmonize_labelled_spss_survey" "haven_labelled_spss"                </span>
<span class="co">#&gt; [3] "haven_labelled"                     </span>
<span class="co">#&gt; attr(,"survey_id_name")</span>
<span class="co">#&gt; [1] "x"</span>
<span class="co">#&gt; attr(,"survey_id_values")</span>
<span class="co">#&gt;     2     1     3     9 </span>
<span class="co">#&gt;     0     1 99997 99999 </span>
<span class="co">#&gt; attr(,"survey_id_label")</span>
<span class="co">#&gt; [1] "TRUST IN INSTITUTIONS: ARMY"</span>
<span class="co">#&gt; attr(,"survey_id_labels")</span>
<span class="co">#&gt;              Tend to trust          Tend not to trust </span>
<span class="co">#&gt;                          1                          2 </span>
<span class="co">#&gt;                         DK Inap. (CY-TCC in isocntry) </span>
<span class="co">#&gt;                          3                          9 </span>
<span class="co">#&gt; attr(,"survey_id_na_values")</span>
<span class="co">#&gt; [1] 9</span></pre></body></html></div>
<p>The attributes are complex, because they leave open reverting to historical coding, and for a choice of categorical or numeric representation in R.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span> ( <span class="fu">as_factor</span>(<span class="no">trust_in_army</span>))
<span class="co">#&gt;   not_trust       trust do_not_know        inap </span>
<span class="co">#&gt;          35          43           8           9</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span> ( <span class="fu">as_numeric</span>(<span class="no">trust_in_army</span>))
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span>
<span class="co">#&gt;  0.0000  0.0000  1.0000  0.5513  1.0000  1.0000      17</span></pre></body></html></div>
<p>Let’s repeat the same harmonization for all <code>trust</code> variables.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">hZA7576</span> <span class="kw">&lt;-</span> <span class="no">hZA7576</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> (<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span> (<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"trust"</span>)), <span class="no">harmonize_trust</span> )
<span class="no">hZA6863</span> <span class="kw">&lt;-</span> <span class="no">hZA6863</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> (<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span> (<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"trust"</span>)), <span class="no">harmonize_trust</span> )

<span class="no">hZA6863</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">all_of</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"trust_army"</span>, <span class="st">"trust_european_union"</span>)))
<span class="co">#&gt; # A tibble: 50 x 2</span>
<span class="co">#&gt;                  trust_army     trust_european_union</span>
<span class="co">#&gt;                &lt;retroh_dbl&gt;             &lt;retroh_dbl&gt;</span>
<span class="co">#&gt;  1     1 [trust]                1 [trust]           </span>
<span class="co">#&gt;  2     0 [not_trust]            1 [trust]           </span>
<span class="co">#&gt;  3 99997 (NA) [do_not_know] 99997 (NA) [do_not_know]</span>
<span class="co">#&gt;  4     0 [not_trust]            1 [trust]           </span>
<span class="co">#&gt;  5 99997 (NA) [do_not_know]     1 [trust]           </span>
<span class="co">#&gt;  6     0 [not_trust]            0 [not_trust]       </span>
<span class="co">#&gt;  7     1 [trust]            99997 (NA) [do_not_know]</span>
<span class="co">#&gt;  8     1 [trust]                1 [trust]           </span>
<span class="co">#&gt;  9     1 [trust]                0 [not_trust]       </span>
<span class="co">#&gt; 10     1 [trust]                1 [trust]           </span>
<span class="co">#&gt; # ... with 40 more rows</span></pre></body></html></div>
<p>Given that the other selected variables have identical (harmonized) names and they are of base type <code>numeric</code> or <code>character</code>, after harmonizing the <code>trust</code> labels and <code>na_values</code>, we can bind the two panels with <code>vectrs::vec_rbind()</code>. Unfortunately, the generic <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> method cannot be implemented to work with this type.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">panel</span> <span class="kw">&lt;-</span> <span class="kw pkg">vctrs</span><span class="kw ns">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_bind.html">vec_rbind</a></span> (
  <span class="no">hZA6863</span>, <span class="no">hZA6863</span>
)</pre></body></html></div>
<p>The panel is created, and it is open for exporting to other statistical software, or further analysis in R. While some basic arithmetic methods are implemented for the <code>labelled_spss_survey</code> class of the <a href="http://retroharmonize.satellitereport.com/">retroharmonize</a> package, for using all R statistical packages, the analyst has to chose a base R type that is compatible with them. Since the <code>trust</code> variables are categorical variables, they can be re-casted with the <code>as_factor()</code> or <code>as_numeric()</code> methods. Again, the base R <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code> or <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code> will give a legible, but not correct representation.</p>
<p>The factor representation presents the user-defined missing values as categories:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">panel</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> (<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span> (<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"trust"</span>)), <span class="no">as_factor</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>()
<span class="co">#&gt;      doi            gesis_archive_version_and_date     uniqid        </span>
<span class="co">#&gt;  Length:100         Length:100                     Min.   :1.10e+08  </span>
<span class="co">#&gt;  Class :character   Class :character               1st Qu.:3.20e+08  </span>
<span class="co">#&gt;  Mode  :character   Mode  :character               Median :6.30e+08  </span>
<span class="co">#&gt;                                                    Mean   :6.12e+08  </span>
<span class="co">#&gt;                                                    3rd Qu.:1.00e+09  </span>
<span class="co">#&gt;                                                    Max.   :1.00e+09  </span>
<span class="co">#&gt;  country_code_iso_3166       trust_army  trust_european_union</span>
<span class="co">#&gt;  Length:100            not_trust  :34   not_trust  :38       </span>
<span class="co">#&gt;  Class :character      trust      :46   trust      :40       </span>
<span class="co">#&gt;  Mode  :character      do_not_know:10   do_not_know:12       </span>
<span class="co">#&gt;                        inap       :10   inap       :10       </span>
<span class="co">#&gt;                                                              </span>
<span class="co">#&gt;                                                              </span>
<span class="co">#&gt;  trust_european_union_tcc  trust_justice_system trust_national_government</span>
<span class="co">#&gt;  not_trust: 4             not_trust  :42        not_trust  :44           </span>
<span class="co">#&gt;  trust    : 6             trust      :46        trust      :34           </span>
<span class="co">#&gt;  inap     :90             do_not_know: 2        do_not_know:12           </span>
<span class="co">#&gt;                           inap       :10        inap       :10           </span>
<span class="co">#&gt;                                                                          </span>
<span class="co">#&gt;                                                                          </span>
<span class="co">#&gt;  trust_national_parliament      trust_police trust_political_parties</span>
<span class="co">#&gt;  not_trust  :40            not_trust  :30    not_trust  :56         </span>
<span class="co">#&gt;  trust      :36            trust      :56    trust      :24         </span>
<span class="co">#&gt;  do_not_know:14            do_not_know: 4    do_not_know:10         </span>
<span class="co">#&gt;  inap       :10            inap       :10    inap       :10         </span>
<span class="co">#&gt;                                                                     </span>
<span class="co">#&gt;                                                                     </span>
<span class="co">#&gt;  trust_political_parties_tcc trust_public_administration</span>
<span class="co">#&gt;  not_trust:10                not_trust  :38             </span>
<span class="co">#&gt;  inap     :90                trust      :44             </span>
<span class="co">#&gt;                              do_not_know: 8             </span>
<span class="co">#&gt;                              inap       :10             </span>
<span class="co">#&gt;                                                         </span>
<span class="co">#&gt;                                                         </span>
<span class="co">#&gt;  trust_regional_local_authorities  trust_united_nations</span>
<span class="co">#&gt;  not_trust  :38                   not_trust  :38       </span>
<span class="co">#&gt;  trust      :40                   trust      :38       </span>
<span class="co">#&gt;  do_not_know:12                   do_not_know:14       </span>
<span class="co">#&gt;  inap       :10                   inap       :10       </span>
<span class="co">#&gt;                                                        </span>
<span class="co">#&gt;                                                        </span>
<span class="co">#&gt;  trust_united_nations_tcc weight_result_from_target_redressment</span>
<span class="co">#&gt;  not_trust: 4             Min.   :0.4376                       </span>
<span class="co">#&gt;  trust    : 6             1st Qu.:0.7858                       </span>
<span class="co">#&gt;  inap     :90             Median :1.0876                       </span>
<span class="co">#&gt;                           Mean   :1.1537                       </span>
<span class="co">#&gt;                           3rd Qu.:1.4168                       </span>
<span class="co">#&gt;                           Max.   :2.5878                       </span>
<span class="co">#&gt;  weight_germany   weight_extrapolated_population_aged_gt_15</span>
<span class="co">#&gt;  Min.   :0.0000   Min.   :  203.8                          </span>
<span class="co">#&gt;  1st Qu.:0.0000   1st Qu.: 1506.2                          </span>
<span class="co">#&gt;  Median :0.0000   Median : 5816.5                          </span>
<span class="co">#&gt;  Mean   :0.3344   Mean   :18774.5                          </span>
<span class="co">#&gt;  3rd Qu.:0.5392   3rd Qu.:24301.3                          </span>
<span class="co">#&gt;  Max.   :2.1909   Max.   :95773.7</span></pre></body></html></div>
<p>And let’s compare this with the numeric representation, where the user-defined missing values are treated as missing:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">panel</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> (<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span> (<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"trust"</span>)), <span class="no">as_numeric</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>()
<span class="co">#&gt;      doi            gesis_archive_version_and_date     uniqid        </span>
<span class="co">#&gt;  Length:100         Length:100                     Min.   :1.10e+08  </span>
<span class="co">#&gt;  Class :character   Class :character               1st Qu.:3.20e+08  </span>
<span class="co">#&gt;  Mode  :character   Mode  :character               Median :6.30e+08  </span>
<span class="co">#&gt;                                                    Mean   :6.12e+08  </span>
<span class="co">#&gt;                                                    3rd Qu.:1.00e+09  </span>
<span class="co">#&gt;                                                    Max.   :1.00e+09  </span>
<span class="co">#&gt;                                                                      </span>
<span class="co">#&gt;  country_code_iso_3166   trust_army    trust_european_union</span>
<span class="co">#&gt;  Length:100            Min.   :0.000   Min.   :0.0000      </span>
<span class="co">#&gt;  Class :character      1st Qu.:0.000   1st Qu.:0.0000      </span>
<span class="co">#&gt;  Mode  :character      Median :1.000   Median :1.0000      </span>
<span class="co">#&gt;                        Mean   :0.575   Mean   :0.5128      </span>
<span class="co">#&gt;                        3rd Qu.:1.000   3rd Qu.:1.0000      </span>
<span class="co">#&gt;                        Max.   :1.000   Max.   :1.0000      </span>
<span class="co">#&gt;                        NA's   :20      NA's   :22          </span>
<span class="co">#&gt;  trust_european_union_tcc trust_justice_system trust_national_government</span>
<span class="co">#&gt;  Min.   :0.0              Min.   :0.0000       Min.   :0.0000           </span>
<span class="co">#&gt;  1st Qu.:0.0              1st Qu.:0.0000       1st Qu.:0.0000           </span>
<span class="co">#&gt;  Median :1.0              Median :1.0000       Median :0.0000           </span>
<span class="co">#&gt;  Mean   :0.6              Mean   :0.5227       Mean   :0.4359           </span>
<span class="co">#&gt;  3rd Qu.:1.0              3rd Qu.:1.0000       3rd Qu.:1.0000           </span>
<span class="co">#&gt;  Max.   :1.0              Max.   :1.0000       Max.   :1.0000           </span>
<span class="co">#&gt;  NA's   :90               NA's   :12           NA's   :22               </span>
<span class="co">#&gt;  trust_national_parliament  trust_police    trust_political_parties</span>
<span class="co">#&gt;  Min.   :0.0000            Min.   :0.0000   Min.   :0.0            </span>
<span class="co">#&gt;  1st Qu.:0.0000            1st Qu.:0.0000   1st Qu.:0.0            </span>
<span class="co">#&gt;  Median :0.0000            Median :1.0000   Median :0.0            </span>
<span class="co">#&gt;  Mean   :0.4737            Mean   :0.6512   Mean   :0.3            </span>
<span class="co">#&gt;  3rd Qu.:1.0000            3rd Qu.:1.0000   3rd Qu.:1.0            </span>
<span class="co">#&gt;  Max.   :1.0000            Max.   :1.0000   Max.   :1.0            </span>
<span class="co">#&gt;  NA's   :24                NA's   :14       NA's   :20             </span>
<span class="co">#&gt;  trust_political_parties_tcc trust_public_administration</span>
<span class="co">#&gt;  Min.   :0                   Min.   :0.0000             </span>
<span class="co">#&gt;  1st Qu.:0                   1st Qu.:0.0000             </span>
<span class="co">#&gt;  Median :0                   Median :1.0000             </span>
<span class="co">#&gt;  Mean   :0                   Mean   :0.5366             </span>
<span class="co">#&gt;  3rd Qu.:0                   3rd Qu.:1.0000             </span>
<span class="co">#&gt;  Max.   :0                   Max.   :1.0000             </span>
<span class="co">#&gt;  NA's   :90                  NA's   :18                 </span>
<span class="co">#&gt;  trust_regional_local_authorities trust_united_nations trust_united_nations_tcc</span>
<span class="co">#&gt;  Min.   :0.0000                   Min.   :0.0          Min.   :0.0             </span>
<span class="co">#&gt;  1st Qu.:0.0000                   1st Qu.:0.0          1st Qu.:0.0             </span>
<span class="co">#&gt;  Median :1.0000                   Median :0.5          Median :1.0             </span>
<span class="co">#&gt;  Mean   :0.5128                   Mean   :0.5          Mean   :0.6             </span>
<span class="co">#&gt;  3rd Qu.:1.0000                   3rd Qu.:1.0          3rd Qu.:1.0             </span>
<span class="co">#&gt;  Max.   :1.0000                   Max.   :1.0          Max.   :1.0             </span>
<span class="co">#&gt;  NA's   :22                       NA's   :24           NA's   :90              </span>
<span class="co">#&gt;  weight_result_from_target_redressment weight_germany  </span>
<span class="co">#&gt;  Min.   :0.4376                        Min.   :0.0000  </span>
<span class="co">#&gt;  1st Qu.:0.7858                        1st Qu.:0.0000  </span>
<span class="co">#&gt;  Median :1.0876                        Median :0.0000  </span>
<span class="co">#&gt;  Mean   :1.1537                        Mean   :0.3344  </span>
<span class="co">#&gt;  3rd Qu.:1.4168                        3rd Qu.:0.5392  </span>
<span class="co">#&gt;  Max.   :2.5878                        Max.   :2.1909  </span>
<span class="co">#&gt;                                                        </span>
<span class="co">#&gt;  weight_extrapolated_population_aged_gt_15</span>
<span class="co">#&gt;  Min.   :  203.8                          </span>
<span class="co">#&gt;  1st Qu.: 1506.2                          </span>
<span class="co">#&gt;  Median : 5816.5                          </span>
<span class="co">#&gt;  Mean   :18774.5                          </span>
<span class="co">#&gt;  3rd Qu.:24301.3                          </span>
<span class="co">#&gt;  Max.   :95773.7                          </span>
<span class="co">#&gt; </span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Antal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
